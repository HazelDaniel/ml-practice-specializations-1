#!/usr/bin/env python3

import tensorflow as tf
from tensorflow.keras import Sequential
from tensorflow.keras.layers import Dense
import numpy as np

# binary digit classification (1 or not?)
## template:
"""
0 0 0 0   255 0 0 0
0 0 0 255 255 0 0 0
0 0 0 0   255 0 0 0
0 0 0 0   255 0 0 0
0 0 0 0   255 0 0 0
0 0 0 0   255 0 0 0
255 255 255 255 255 255 255
255 255 255 255 255 255 255
"""
"""
0 0 255 255 255 255 0 0
0 255 0 0 0 0     255 0
255 0 0 0 0 0     255 0
255 0 0 0 0 0     0 255
255 0 0 0 0 0     0 255
0 255 0 0 0 0     255 0
0 255 0 0 0     0 255 0
0 0 255 255 255 255 0 0
"""

x_1 = np.array([0, 0, 0, 0, 255, 0, 0, 0,
              0, 0, 0,  255, 255, 0, 0, 0,
              0, 0, 0, 0, 255, 0, 0, 0,
              0, 0, 0, 0, 255, 0, 0, 0,
              0, 0, 0, 0, 255, 0, 0, 0,
              0, 0, 0, 0, 255, 0, 0, 0,
              255, 255, 255, 255, 255, 255, 255, 255,
              255, 255, 255, 255, 255, 255, 255, 255])
x_2 = np.array([0, 0, 255, 255, 255, 255, 0, 0,
              0, 255, 0,  0, 0, 0, 255, 0,
              255, 0, 0, 0, 0, 0, 255, 0,
              255, 0, 0, 0, 0, 0, 0, 255,
              255, 0, 0, 0, 0, 0, 0, 255,
              0, 255, 0, 0, 0, 0, 255, 0,
              0, 255, 0, 0, 0, 0, 255, 0,
              0, 0, 255, 255, 255, 255, 0, 0,])
x_3 = np.array([ 0, 0, 0,   255,   0, 0, 0, 0,
        0, 0, 255, 255, 0, 0, 0, 0,
        0, 0, 0,   255,   0, 0, 0, 0,
        0, 0, 0,   255,   0, 0, 0, 0,
        0, 0, 0,   255,   0, 0, 0, 0,
        0, 0, 0,   255,   0, 0, 0, 0,
        255, 255, 255, 255, 255, 255, 255, 255,
        255, 255, 255, 255, 255, 255, 255, 255 ])


X = np.array([x_1, x_2, x_3])
Y = np.array([1, 0, 1], dtype=np.float32)

# ----- DIGIT 1s -----
one_1 = np.array([
    0,0,0,0,255,0,0,0,
    0,0,0,255,255,0,0,0,
    0,0,0,0,255,0,0,0,
    0,0,0,0,255,0,0,0,
    0,0,0,0,255,0,0,0,
    0,0,0,0,255,0,0,0,
    0,0,0,0,255,0,0,0,
    255,255,255,255,255,255,255,255
])

one_2 = np.array([
    0,0,255,0,0,0,0,0,
    0,255,255,0,0,0,0,0,
    0,0,255,0,0,0,0,0,
    0,0,255,0,0,0,0,0,
    0,0,255,0,0,0,0,0,
    0,0,255,0,0,0,0,0,
    0,0,255,0,0,0,0,0,
    255,255,255,255,255,255,255,255
])

# ----- DIGIT 0s -----
zero_1 = np.array([
    0,255,255,255,255,255,255,0,
    255,0,0,0,0,0,0,255,
    255,0,0,0,0,0,0,255,
    255,0,0,0,0,0,0,255,
    255,0,0,0,0,0,0,255,
    255,0,0,0,0,0,0,255,
    255,0,0,0,0,0,0,255,
    0,255,255,255,255,255,255,0
])

zero_2 = np.array([
    0,0,255,255,255,255,0,0,
    0,255,0,0,0,0,255,0,
    255,0,0,0,0,0,0,255,
    255,0,0,0,0,0,0,255,
    255,0,0,0,0,0,0,255,
    255,0,0,0,0,0,0,255,
    0,255,0,0,0,0,255,0,
    0,0,255,255,255,255,0,0
])

test_samples = [
    (one_1, 1),
    (one_2, 1),
    (zero_1, 0),
    (zero_2, 0),
]

x_new = np.array([0, 0, 0, 0, 255, 0, 0, 0,
                  0, 0, 0,  255, 255, 0, 0, 0,
                  0, 0, 255, 0,    255, 0, 0, 0,
                  0, 255, 0, 0,    255, 0, 0, 0,
                  0, 255, 0, 0,    255, 0, 255, 0,
                  0, 0, 255, 0,    0, 255, 255, 0,
                  0, 0, 0,  0, 255, 255, 0, 0,
                  0, 0, 255, 255, 255, 255, 0, 0])

test_samples.append((x_new, 0))


model = Sequential([Dense(units=25, activation='sigmoid', input_shape=(64,)), Dense(units=15, activation='sigmoid',), Dense(units=1, activation='sigmoid',)])

from tensorflow.keras.losses import BinaryCrossentropy
model.compile(loss=BinaryCrossentropy(from_logits=False))
model.fit(X, Y, epochs=100)


def run_inference():
    correct = 0
    for x, y_true in test_samples:
        pred = model.predict(x.reshape(1, -1), verbose=0)[0][0]
        y_pred = 1 if pred >= 0.5 else 0

        print(f"pred={pred:.3f}, predicted={y_pred}, actual={y_true}")

        if y_pred == y_true:
            correct += 1

    accuracy = correct / len(test_samples)
    print(f"Accuracy: {accuracy:.2%}")


if __name__ == "__main__":
    run_inference()
